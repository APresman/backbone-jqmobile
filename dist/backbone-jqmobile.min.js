/* ####### SET JQUERY MOBILE DEFAULTS ######## */$(document).bind("mobileinit",function(){console.log("setting Jquery mobile on mobile init"),$.mobile.ajaxEnabled=!1,$.mobile.linkBindingEnabled=!1,$.mobile.hashListeningEnabled=!1,$.mobile.pushStateEnabled=!1}),window.jumpui={},jumpui.JqmApp=Backbone.Model.extend({initialize:function(){if(this.attributes.platform==undefined)throw"Platform is not specified for this app";if(this.attributes.containerEl==undefined)throw"containerEl is not specified for this app";_.extend(this,this.attributes),this.pages={},this.router=new Backbone.Router,this.platform.setup()},load:function(e){e=e||{};if(this.pages.length<=0)throw"No pages found in app";$(this.containerEl).live("pageshow",function(e,t){$(t.prevPage).remove()}),Backbone.history.start()},addPage:function(e){if(this.router==undefined)throw"Cannot add page before router is set in Application";e.app=this,this.theme&&(e.attributes["data-theme"]=this.theme),this._registerPage(e),this.pages[e.name]=e},navigate:function(e){this.router.navigate(e,{trigger:!0})},_registerPage:function(e){var t=this;this.router.route(e.route,e.name,function(){var n=arguments;e._load(n,$(t.containerEl))?(t.currentPage&&(t.currentPage.visible=!1),t.currentPage=e,t.currentPage.visible=!0,$(e.el).trigger("jui-pageloaded")):console.log("Not loading page "+e.name+" as process returned negetive")})},_jQChangePage:function(e){$.mobile.changePage($(e.el))}}),jumpui.Platform=Backbone.Model.extend({initialize:function(){},setup:function(){}}),jumpui.Platform.CORDOVA=new jumpui.Platform({}),jumpui.Platform.WEB=new jumpui.Platform({}),jumpui.internal={},jumpui.internal.AbstractView=Backbone.View.extend({initialize:function(){_.extend(this,this.options);if(this.ui){var e=this;this._ui||(this._ui=_.clone(this.ui));var t=this._ui;_.each(t,function(t,n){console.log("fetch "+n+", "+t),e.ui[n]=e.$(t)})}this.init&&this.init()},close:function(){this.remove(),this.unbind(),this.onClose&&this.onClose()}}),jumpui.template={},jumpui.template.engine={},jumpui.TemplateEngine=Backbone.Model.extend({parse:function(e,t){return e}}),jumpui.template.engine.Underscore=jumpui.TemplateEngine.extend({parse:function(e,t){throw"UNDERSCORE not implemented yet"}}),jumpui.template.engine.Handlebars=jumpui.TemplateEngine.extend({initialize:function(e){_.extend(this,e);var t=this.helpers||{};_.each(_.keys(t),function(e){Handlebars.registerHelper(e,t[e])})},parse:function(e,t,n){var r=$("#"+e).html();return this.parseHtml(r,t,n)},parseHtml:function(e,t,n){var r=Handlebars.compile(e);return t.fragments=n,r(t)},registerPartial:function(e){Handlebars.registerPartial(e,$("#"+e).html())}}),jumpui.fragment={},jumpui.Fragment=jumpui.internal.AbstractView.extend({initialize:function(){jumpui.internal.AbstractView.prototype.initialize.apply(this,arguments),this.dataFragment=this.template},getModel:function(){return{}},render:function(){this.$el&&this.$el.empty();if($.isFunction(this.template)){this.$el.append(this.block.page.app.templateEngine.parseHtml(this.template(this.model),this.getModel()));return}if(this.template!=undefined){this.$el.append(this.block.page.app.templateEngine.parse(this.template,this.getModel()));return}if(this.getContent==null)throw"Neither template nor getContent method found";$(this.el).empty().append($(this.getContent()))},createHtml:function(e,t){return"<"+this.tagName+" id='"+this.id+"'>"+e.parse(this.template,t)+"</"+this.tagName+">"},_setEl:function(e){this.setElement(e)}}),jumpui.block={},jumpui.Block=jumpui.internal.AbstractView.extend({tagName:"div",fragments:{},initialize:function(){jumpui.internal.AbstractView.prototype.initialize.apply(this,arguments);var e=this;_.each(this.fragments,function(t){t.block=e})},render:function(){$(this.el).remove(),this.setElement(this.make(this.tagName,this.attributes));var e=$(this.el);if(this.template){var t=this,n={};$.isFunction(this.template)?e.append(this.page.app.templateEngine.parseHtml(this.template(this.model),this.model,n)):this.template!=undefined&&e.append(this.page.app.templateEngine.parse(this.template,this.model,n)),_.each(this.fragments,function(e,n){e._setEl(t.$("[data-fragment="+n+"]")),e.render()});return}if(this.getContent==null)throw"Neither template nor getContent method found";$(this.el).empty().append($(this.getContent()))}}),jumpui.block.Header=jumpui.Block.extend({className:"jump-header",attributes:{"data-role":"header"}}),jumpui.block.Footer=jumpui.Block.extend({className:"jump-footer",attributes:{"data-role":"footer"}}),jumpui.block.Content=jumpui.Block.extend({className:"jump-content",attributes:{"data-role":"content"}}),jumpui.Page=Backbone.View.extend({tagName:"div",className:"jump-page",attributes:{"data-role":"page"},initialize:function(e){_.bindAll(this,"reload");if(e==undefined||e.name==undefined)throw"name property is compulsory";if(e.prepare==undefined)throw"prepare property is compulsory";_.extend(this,e),this.id=e.name,this.loaded=!1,this.route==undefined&&(this.route=this.name),this.setBlocks(e.blocks||{});if(this.ui){this._ui||(this._ui=_.clone(this.ui));var t=this._ui;_.each(t,function(e,t){console.log("fetch "+t+", "+e),self.ui[t]=self.$(e)})}this.init&&this.init()},setBlocks:function(e){var t=this;this.blocks=e,_.each(this.blocks,function(e){e.page=t})},isLoaded:function(){return!1},_attachAndProcess:function(e){e.append(this.el),$(this.el).page(),this.loaded=!0},load:function(e){e.append(this.el),$(this.el).page(),this.loaded=!0},_createDom:function(){var e=this;this.setElement(this.make(this.tagName,this.attributes)),_.each(_.keys(this.blocks),function(t){var n=e.blocks[t];n.model==undefined&&(n.model={}),_.extend(n.model,n.page.model),n.render(),$(e.el).append(n.el)})},render:function(){console.log("Rendering "+this.name,this),this._createDom(),$(this.el).trigger("jui-pagerendered")},_load:function(e,t){var n=!1;n=this.prepare.apply(this,e);if(!n)return;return _.every(this.blocks,function(t){if(t.prepare)return n=t.prepare.apply(t,e),n}),n?(this.render(),this._attachAndProcess(t),this.app._jQChangePage(this),!0):!1},reload:function(e){e=e||[];if(!$.isArray(e))throw console.log("Arguments must be array",e),"Arguments must be array";return this.visible?(console.log("reloading page "+this.name),this._load(e,$(this.app.containerEl))):(console.log("Unable to reload page "+this.name+", as page is not current/visible page"),!1)}}),jumpui.fragment=jumpui.fragment||{},jumpui.fragment.ListItem=Backbone.View.extend({tagName:"li",attribute:"name",model:undefined,render:function(){this.$el.html(this.model.get(this.attribute))}}),jumpui.fragment.formItems={text:jumpui.internal.AbstractView.extend({tagName:"input"})},jumpui.fragment.Form=jumpui.Fragment.extend({model:undefined,items:undefined,ui:{form:"form",formItems:"form .form-items"},init:function(){},_createItem:function(e,t){var n=$("<div>").attr("data-role","fieldcontain");n.append($("<label>").attr("for",e.attr).text(e.label));var r=new jumpui.fragment.formItems[e.type]({attributes:{type:e.type,name:e.attr,id:e.attr}});return r.render(),this.ui.formItems!=undefined?n.append(this.ui.formItems):n.append(r.$el),n},getContainer:function(){if(this.ui.form==null||this.ui.form==undefined)this.ui.form=$("<form>"),this.ui.form.attr("data-inset",this.options.inset);return this.ui.formItems},render:function(){var e=this.getContainer(),t=this;_.each(this.items,function(n){var r=t._createItem(n,e);e.append(r)}),this.$el.append(e)}}),jumpui.fragment.List=jumpui.Fragment.extend({collection:undefined,ItemView:undefined,options:{inset:!0},init:function(){_.bindAll(this,"refresh");if(this.collection===undefined)throw"Collection is null";this.collection.on("reset",this.refresh),this.collection.on("add",this.refresh),this.collection.on("remove",this.refresh)},refresh:function(){this.render(),this.$("ul").listview()},getModel:function(){return{list:this.collection.toJSON()}},getContainer:function(){var e=$("<ul></ul>");return e.attr("data-role","listview"),e.attr("data-inset",this.options.inset),e},render:function(){this.$el.empty();var e=this.getContainer(),t=this;this.collection.each(function(n){var r=new t.ItemView({model:n});r.render(),e.append(r.$el)}),this.$el.append(e)}});