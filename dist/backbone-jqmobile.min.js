/* ####### SET JQUERY MOBILE DEFAULTS ######## */$(document).bind("mobileinit",function(){console.log("setting Jquery mobile on mobile init"),$.mobile.ajaxEnabled=!1,$.mobile.linkBindingEnabled=!1,$.mobile.hashListeningEnabled=!1,$.mobile.pushStateEnabled=!1}),window.jumpui={},jumpui.JqmApp=Backbone.Model.extend({initialize:function(){if(this.attributes.platform==undefined)throw"Platform is not specified for this app";if(this.attributes.containerEl==undefined)throw"containerEl is not specified for this app";_.extend(this,this.attributes),this.pages={},this.router=new Backbone.Router,this.platform.setup()},load:function(e){e=e||{};if(this.pages.length<=0)throw"No pages found in app";var t=this;_.each(this.pages,function(e){t.router.route(e.route,e.name,function(){var n=arguments;e._load(n,$(t.containerEl))?(t.currentPage&&(t.currentPage.visible=!1),t.currentPage=e,t.currentPage.visible=!0,$(e.el).trigger("jui-pageloaded")):console.log("Not loading page "+e.name+" as process returned negetive")})}),$(this.containerEl).live("pageshow",function(e,t){$(t.prevPage).remove()}),Backbone.history.start()},addPage:function(e){e.app=this,this.theme&&(e.attributes["data-theme"]=this.theme),this.pages[e.name]=e},navigate:function(e){this.router.navigate(e,{trigger:!0})},_jQChangePage:function(e){$.mobile.changePage($(e.el))}}),jumpui.Platform=Backbone.Model.extend({initialize:function(){},setup:function(){}}),jumpui.Platform.CORDOVA=new jumpui.Platform({}),jumpui.Platform.WEB=new jumpui.Platform({}),jumpui.template={},jumpui.template.engine={},jumpui.TemplateEngine=Backbone.Model.extend({parse:function(e,t){return e}}),jumpui.template.engine.Underscore=jumpui.TemplateEngine.extend({parse:function(e,t){throw"UNDERSCORE not implemented yet"}}),jumpui.template.engine.Handlebars=jumpui.TemplateEngine.extend({initialize:function(e){_.extend(this,e);var t=this.helpers||{};_.each(_.keys(t),function(e){Handlebars.registerHelper(e,t[e])})},parse:function(e,t,n){var r=$("#"+e).html(),i=Handlebars.compile(r);return t.fragments=n,i(t)},registerPartial:function(e){Handlebars.registerPartial(e,$("#"+e).html())}}),jumpui.internal={},jumpui.internal.AbstractView=Backbone.View.extend({initialize:function(){_.extend(this,this.options),this.init&&this.init()}}),jumpui.block={},jumpui.Block=jumpui.internal.AbstractView.extend({tagName:"div",fragments:{},initialize:function(){jumpui.internal.AbstractView.prototype.initialize.apply(this,arguments);var e=this;_.each(this.fragments,function(t){t.block=e})},render:function(){$(this.el).remove(),this.setElement(this.make(this.tagName,this.attributes));var e=$(this.el);if(this.templateKey){var t=this,n={};e.append(this.page.app.templateEngine.parse(this.templateKey,this.model,n)),_.each(this.fragments,function(e,n){e._setEl(t.$("[data-fragment="+n+"]")),e.render()});return}if(this.getContent==null)throw"Neither templateKey nor getContent method found";$(this.el).empty().append($(this.getContent()))}}),jumpui.block.Header=jumpui.Block.extend({className:"jump-header",attributes:{"data-role":"header"}}),jumpui.block.Footer=jumpui.Block.extend({className:"jump-footer",attributes:{"data-role":"footer"}}),jumpui.block.Content=jumpui.Block.extend({className:"jump-content",attributes:{"data-role":"content"}}),jumpui.fragment={},jumpui.Fragment=jumpui.internal.AbstractView.extend({initialize:function(){jumpui.internal.AbstractView.prototype.initialize.apply(this,arguments),this.dataFragment=this.templateKey},getModel:function(){return{}},render:function(){this.$el&&this.$el.empty();if(this.templateKey){this.$el.append(this.block.page.app.templateEngine.parse(this.templateKey,this.getModel()));return}if(this.getContent==null)throw"Neither templateKey nor getContent method found";$(this.el).empty().append($(this.getContent()))},createHtml:function(e,t){return"<"+this.tagName+" id='"+this.id+"'>"+e.parse(this.templateKey,t)+"</"+this.tagName+">"},_setEl:function(e){this.setElement(e)}}),jumpui.Page=Backbone.View.extend({tagName:"div",className:"jump-page",attributes:{"data-role":"page"},initialize:function(e){_.bindAll(this,"reload");if(e==undefined||e.name==undefined)throw"name property is compulsory";if(e.prepare==undefined)throw"prepare property is compulsory";_.extend(this,e),this.id=e.name,this.loaded=!1,this.route==undefined&&(this.route=this.name),this.setBlocks(e.blocks||{}),this.init&&this.init()},setBlocks:function(e){var t=this;this.blocks=e,_.each(this.blocks,function(e){e.page=t})},isLoaded:function(){return!1},_attachAndProcess:function(e){e.append(this.el),$(this.el).page(),this.loaded=!0},load:function(e){e.append(this.el),$(this.el).page(),this.loaded=!0},_createDom:function(){var e=this;this.setElement(this.make(this.tagName,this.attributes)),_.each(_.keys(this.blocks),function(t){var n=e.blocks[t];n.model==undefined&&(n.model={}),_.extend(n.model,n.page.model),n.render(),$(e.el).append(n.el)})},render:function(){console.log("Rendering "+this.name,this),this._createDom(),$(this.el).trigger("jui-pagerendered")},_load:function(e,t){var n=!1;n=this.prepare.apply(this,e);if(!n)return;return _.every(this.blocks,function(t){if(t.prepare)return n=t.prepare.apply(t,e),n}),n?(this.render(),this._attachAndProcess(t),this.app._jQChangePage(this),!0):!1},reload:function(e){e=e||[];if(!$.isArray(e))throw console.log("Arguments must be array",e),"Arguments must be array";return this.visible?(console.log("reloading page "+this.name),this._load(e,$(this.app.containerEl))):(console.log("Unable to reload page "+this.name+", as page is not current/visible page"),!1)}});