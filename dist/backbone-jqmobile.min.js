/* ######## APP ############# */window.jumpui={},jumpui.JqmApp=Backbone.Model.extend({initialize:function(){if(this.attributes.platform==undefined)throw"Platform is not specified for this app";if(this.attributes.containerEl==undefined)throw"containerEl is not specified for this app";_.extend(this,this.attributes),this.pages={},this.router=new Backbone.Router,this.platform.setup()},load:function(e){e=e||{};if(this.pages.length<=0)throw"No pages found in app";var t=this;_.each(this.pages,function(e){t.router.route(e.route,e.name,function(){var n=arguments;e._load(n,$(t.containerEl))?(t.currentPage&&(t.currentPage.visible=!1),t.currentPage=e,t.currentPage.visible=!0,$(e.el).trigger("jui-pageloaded")):console.log("Not loading page "+e.name+" as process returned negetive")})}),$(this.containerEl).live("pageshow",function(e,t){$(t.prevPage).remove()}),Backbone.history.start()},addPage:function(e){e.app=this,this.theme&&(e.attributes["data-theme"]=this.theme),this.pages[e.name]=e},navigate:function(e){this.router.navigate(e,{trigger:!0})},_jQChangePage:function(e){$.mobile.changePage($(e.el))}}),jumpui.Platform=Backbone.Model.extend({setup:function(){console.log("in setup"),$(document).bind("mobileinit",function(){console.log("hash listening false"),$.mobile.ajaxEnabled=!1,$.mobile.linkBindingEnabled=!1,$.mobile.hashListeningEnabled=!1,$.mobile.pushStateEnabled=!1})}}),jumpui.Platform.CORDOVA=new jumpui.Platform({setup:function(){$.mobile.ajaxEnabled=!1,$.mobile.linkBindingEnabled=!1,$.mobile.hashListeningEnabled=!1,$.mobile.pushStateEnabled=!1}}),jumpui.Platform.WEB=new jumpui.Platform({}),jumpui.template={},jumpui.template.engine={},jumpui.TemplateEngine=Backbone.Model.extend({parse:function(e,t){return e}}),jumpui.template.engine.Underscore=jumpui.TemplateEngine.extend({parse:function(e,t){throw"UNDERSCORE not implemented yet"}}),jumpui.template.engine.Handlebars=jumpui.TemplateEngine.extend({initialize:function(e){_.extend(this,e);var t=this.helpers||{};_.each(_.keys(t),function(e){Handlebars.registerHelper(e,t[e])})},parse:function(e,t){var n=$("#"+e).html(),r=Handlebars.compile(n);return r(t)}}),jumpui.block={},jumpui.Block=Backbone.View.extend({tagName:"div",initialize:function(){_.extend(this,this.options),this.init&&this.init()},render:function(){$(this.el).remove(),this.setElement(this.make(this.tagName,this.attributes));var e=$(this.el);if(this.templateKey){e.append(this.page.app.templateEngine.parse(this.templateKey,this.model));return}if(this.getContent==null)return $(this.el).empty().append("<p>Default Block Content</p>");$(this.el).empty().append($(this.getContent()))}}),jumpui.block.Header=jumpui.Block.extend({className:"jump-header",attributes:{"data-role":"header"}}),jumpui.block.Footer=jumpui.Block.extend({className:"jump-footer",attributes:{"data-role":"footer"}}),jumpui.block.Content=jumpui.Block.extend({className:"jump-content",attributes:{"data-role":"content"}}),jumpui.Page=Backbone.View.extend({tagName:"div",className:"jump-page",attributes:{"data-role":"page"},initialize:function(e){_.bindAll(this,"reload");if(e==undefined||e.name==undefined)throw"name property is compulsory";if(e.prepare==undefined)throw"prepare property is compulsory";_.extend(this,e),this.id=e.name,this.loaded=!1,this.route==undefined&&(this.route=this.name),this.setBlocks(e.blocks||{}),this.init&&this.init()},setBlocks:function(e){var t=this;this.blocks=e,_.each(this.blocks,function(e){e.page=t})},isLoaded:function(){return!1},_attachAndProcess:function(e){e.append(this.el),$(this.el).page(),this.loaded=!0},load:function(e){e.append(this.el),$(this.el).page(),this.loaded=!0},_createDom:function(){var e=this;this.setElement(this.make(this.tagName,this.attributes)),_.each(_.keys(this.blocks),function(t){var n=e.blocks[t];n.model==undefined&&(n.model={}),_.extend(n.model,n.page.model),n.render(),$(e.el).append(n.el)})},render:function(){console.log("Rendering "+this.name,this),this._createDom(),$(this.el).trigger("jui-pagerendered")},_load:function(e,t){var n=!1;n=this.prepare.apply(this,e);if(!n)return;return _.every(this.blocks,function(t){if(t.prepare)return n=t.prepare.apply(t,e),n}),n?(this.render(),this._attachAndProcess(t),this.app._jQChangePage(this),!0):!1},reload:function(e){return this.visible?(console.log("reloading page "+this.name),this._load(e,$(this.app.containerEl))):(console.log("Unable to reload page "+this.name+", as page is not current/visible page"),!1)}});